# NHPflex2025

**Project:** Stable, acute recordings in behaving non-human primates using flexible microelectrodes 

This repository accompanies a bioRxiv preprint describing the design, fabrication, and use of flexible neural probes and associated hardware for acute recordings in non-human primates. It contains all files needed to reproduce the figures in the manuscript, design and fabrication data for probes and PCBs, 3D designs for a microdrive adapter, and the analysis code used in the study.

**Repository Contents**
- **`/data/neurons/`**: Neuron spike files.
- **`/data/drift/`**: Drift metrics used in analyses, built off of KiloSort4 drift correction.
- **`/data/raw/fig1-5/`**: Datasets used to generate Figures 1–5.
- **`/data/raw/supp_fig1-5/`**: Datasets used to generate Supplementary Figures 1–5.
- **`/probes/`**: Probe mask files used for layout.
- **`/pcb/`**: PCB design files and Gerbers for electronics supporting the probes.
- **`/fabrication/`**: Link and step-by-step notes for the probe fabrication process (see `README` inside folder).
- **`/3d/`**: 3D design files (STEP, STL) for the microdrive adapter and mounting parts.
- **`/matlab/`**: All MATLAB analysis code (.m scripts) used in the manuscript. Subfolders include `figures/` with scripts to reproduce each figure.
- **`/figures/`**: Reconstructed figure images generated by the analysis scripts.
- **`/docs/`**: Additional documentation, protocol notes, etc.

**How to Use This Repository**
- Reproduce figures: each figure (1–5) has a dedicated MATLAB script under `matlab/figures/fig1` ... `matlab/figures/fig5`. The scripts are written to load `.mat` data files from `data/` and produce the figures saved to `figures/`.

- Example (interactive MATLAB):

```
cd matlab/figures/fig1
addpath(genpath(fullfile('..','..')))
run('run_figure1.m')
```

-- MATLAB requirements: scripts were developed and tested with **MATLAB R2022a**. Required MathWorks toolboxes used in the analyses include:
	- Signal Processing Toolbox
	- Statistics and Machine Learning Toolbox

	In addition the analysis uses two community toolboxes:
	- `matlabnpy` — a lightweight toolbox to read/write NumPy `.npy`/`.npz` files directly from MATLAB.

	- Open Ephys Analysis Toolbox — used to load and preprocess Open Ephys recordings.

	Then add the toolboxes to your MATLAB path (from MATLAB):

	```matlab
	addpath(genpath(fullfile(pwd,'external','matlabnpy')))
	addpath(genpath(fullfile(pwd,'external','open-ephys-analysis')))
	savepath;
	```

	See each figure's `README.md` for exact version notes and any additional third-party functions. If you do not have MATLAB, some scripts can be compiled with MATLAB Compiler or run as standalone using the MATLAB Runtime (see individual figure `README.md` files for details).

**Probe Fabrication & PCB**
- The `probes/` directory contains mask layouts, and fabrication notes. The `pcb/` directory contains the PCB schematics, Fusion360 project files, and Gerber exports.
- Fabrication process (detailed steps and external resources) are in `fabrication/README.md`. For the fabrication service used in this work, see the [probe fabrication process & vendor link](https://www.fabublox.com/process-editor/899ce03e-38a6-4836-bd59-ae51e0551a5e).

**3D Designs**
- The `3d/` folder includes STEP and STL files for the microdrive adapter used to mount flexible probes.

**Data Availability & Ethics Statement**
- Data used to generate manuscript figures are provided under `data/` with README files describing formats.
- Animal care and use compliance: All animal procedures reported in the accompanying preprint were performed in accordance with institutional and national guidelines and were approved by the Institutional Animal Care and Use Committee (IACUC).

**Reproducing Figures (summary)**
- Each `matlab/figures/figX` folder includes a `README.md` describing inputs (which `.mat` files are required), preprocessing steps, and the exact MATLAB command(s) to run.
- Typical workflow to reproduce a figure:
	- Ensure MATLAB (R2022a+) and required toolboxes are available.
	- Download or point to required `.mat` data in `data/raw/`.
	- Run the `run_figureX.m` scripts.

**Code Organization (MATLAB)**
- `matlab/analysis/`: core analysis functions used across figures (modular `.m` functions).
- `matlab/figures/`: figure-specific pipelines and `run_figureX.m` scripts that generate figure panels from `.mat` inputs.
- `matlab/utils/`: utility functions for file I/O, plotting styles, etc.

**Citation**
When using these data or code, please cite the accompanying preprint:

Woods et al., Stable, acute recordings in behaving non-human primates using flexible microelectrodes, bioRxiv, 2026. https://doi.org/xxxx

**License**
- **Code:** The analysis code, scripts, and design files in this repository are provided under the `MIT` license. See `LICENSE` for full terms.
- **Data:** By default the repository's data are offered under a permissive data license: `Creative Commons Attribution 4.0 International (CC BY 4.0)`. See `DATA_LICENSE.md` for details and citation requirements.
**Contact**
- Contact lead author: `daniel.p.woods@vanderbilt.edu` (replace with real contact)

**Acknowledgements**
The HHMI Hanna Gray Fellowship and the Burroughs Wellcome Fund funded this work. Owen Meilander assisted with sample fabrication within the Vanderbilt Institute for Nanoscale Science and Engineering. We thank Jaela Bills and Kayla Yetman for technical help with experiments. 
---
